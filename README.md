# JmcModLib

# 0. 前言

这是一个我个人做MOD时候用到的基础库，把他抽出来作为前置项目依赖方便个人维护，本来很早就动工了，结果越写越大越写越大。

## 主要亮点
- 文档详尽、XML注释齐全，IDE友好
- 报错信息详细，方便排查问题，同时可以为使用日志库的库自动生成控制输出的配置项
- 测试齐全，大量测试覆盖边界情况（比如反射库就有将近两千行测试）
- 配置相关学习成本极低，只需要在静态字段/属性上添加几个特性就可以自动生成可持久化的配置项和UI，同时完美处理UI库的依赖顺序
- 反射工具库代码量低、性能好，API基本贴合标准库习惯
- 只需把本地化csv文档放在自己的文件夹下即可自动加载本地化，0文件操作代码
- 可扩展性强，比如你可以只需要重载一下接口就可以自定义存储后端，项目本身也按模块划分，内部可维护性强

# 1. 使用方法
开发上，在订阅此MOD后在项目`.csproj`添加引入
```xml
// TODO: 现在还没上传到创意工坊，没有发布ID，等上传后补上
```
不过更推荐直接使用模板`csproj`内容，不仅包含了创意工坊的地点，还包含了一些比较实用的功能，比如自动根据项目文件夹下的`Core/VersionInfo.cs`获取版本号，写入到程序集、每次生成自动将构建的dll复制到项目文件夹下的MOD同名文件夹中，并将这个文件夹的内容与游戏本地MOD文件夹的内容同步，在生成完成后，还会自动跳出弹窗询问是否打开鸭科夫。
// TODO: 等待补充模板文件

本项目有详尽的XML文档注释，引入依赖后在IDE中会有相应的提示。

# 2. 主要功能

## 2.1 配置管理器
- 自动扫描使用`[Config]`标记的静态字段/属性，生成配置项并持久化存储（默认路径是存档路径下的/JmcModLibConfig/，在订阅了相关UI MOD后可以直接在游戏中点击按钮复制路径）
- 在这些字段中，对于标记了`[UIAttribute]`的字段，如果检测到有相应的UI Mod，会自动为其生成UI界面，并与配置项关联；此MOD将会自动处理相关UI Mod的顺序
	>示例：比如你想为一个浮点数配置项生成滑动条UI，可以这样写：
	```cs
    [UIFloatSlider(1, 100)]
    [Config("测试浮点数", group: "分组2")]	// 分组是可选的
    public static float v = 3.14f;
	```
	这样就可以直接生成一个初始值为3.14的范围在1到100之间的滑动条UI，并且这个值会被持久化存储

	或者直接在你的静态方法上标注`[UIButton]`，就可以直接生成一个按钮UI，测试的时候非常方便
- 除此之外，还提供了直接注册配置的API，可以动态创建配置项和按钮，不过对于实例对象需要你自己维护生命周期，你也可以直接从一个值注册一个配置项并传入回调，让MOD托管生命周期。
- 目前暂时只适配了`ModSetting`，后面可以考虑增加适配其他，

## 2.2 日志工具库
- 提供了一个简单的日志系统，可以方便地为每个打印指定等级，并调整打印等级与TAG格式，以免出现某些MOD那样开发时的调试信息在运行时疯狂刷屏、全删掉又不方便用户报BUG时排查
- 提供了日志配置UI的预制件，默认可以生成一个简单的日志配置UI，可以让用户在游戏中调整日志等级与格式（比如选择是否需要输出时间、方法名之类的）
- 为以后更换打印后端留有余地

## 2.3 反射工具库
- 提供了一些反射库API，极大简化了反射调用的代码量
- 同时提供了更好的性能，自动生成缓存，所有调用者都可以共享缓存，同时对于强类型会自动生成委托，经测试百万次双参数方法调用通用接口（93ms）较原始反射调用（581.37ms）耗时减少83.99%、强类型接口（2.13ms)耗时减少99.6%
- 测试齐全，覆盖各种边界情况；功能齐全，标准库反射能做的都能做

更详细的API说明可以查看[文档](/Docs)或者查看XML注释

# 3. 环境依赖与兼容性
- 本MOD仅依赖`Newtonsoft.Json`，版本为13.0.4，模组已内置
- 本MOD不直接强依赖于任何UI Mod，但是建议配合`ModSetting`使用以获得配置项UI支持
- 本MOD不修改游戏任何代码逻辑，理论上不与任何MOD冲突
- 为获得更好的使用体验，建议将本MOD的排序调到最高

# 4. 其他
- 